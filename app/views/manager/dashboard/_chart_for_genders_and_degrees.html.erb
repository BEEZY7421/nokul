<div id="chart-for-genders-degree"></div>

<% categories = data.map { |item| item[:degree] }.uniq %>
<% genders    = data.map { |item| item[:gender] }.uniq.sort %>
<%
  series = genders.map do |gender, hash|
    {
      name: gender,
      color: (
        case gender
        when 'Erkek' then '#96d1c7'
        when 'Kadın' then '#fc7978'
        else              '#ffafb0'
        end
      ),
      data: categories.map do |category|
        row = data.find { |item| item[:degree] == category && item[:gender] == gender } || {}
        row[:number_of_students]
      end
    }
  end
%>

<script>
  Highcharts.chart('chart-for-genders-degree', {
      chart: { type: 'column' },
      title: { text: 'Öğrenim Türlerine Göre Öğrenci Sayıları' },
      xAxis: { categories: <%= categories.to_json.html_safe %> },
      yAxis: {
        min: 0,
        title: { text: 'Toplam Öğrenci Sayısı' },
        stackLabels: { enabled: true }
      },
      tooltip: {
        pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.percentage:.0f}%)<br/>',
        shared: true
      },
      plotOptions: { column: { stacking: 'normal' } },
      series: <%= series.to_json.html_safe %>
  });
</script>

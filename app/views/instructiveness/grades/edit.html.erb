<div class='row'>
  <div class='col-lg-12'>
    <div class='alert alert-light'>
      <%= link_to_back(:back) %>
    </div>
    <div class='card'>
      <div class='card-header'>
        <%= fa_icon 'users' %><b><%= t('.students', course_name: @course.name) %></b>
        <span class='pull-right'>
          <input type="submit" value=<%= t('save') %> class="btn btn-outline-success btn-sm" form="grades_form">
        </span>
      </div>
      <div class='card-body'>
        <%= simple_form_for(:grade, url: given_course_assessment_grades_path(@course, @assessment), html: { id: 'grades_form' }) do |f| %>
          <% @groups.includes(:saved_enrollments).each do |group| %>
            <div class='card-header'>
              <%= fa_icon 'cube' %><b><%= group.name %></b>
            </div>
            <table class='table table-sm table-striped'>
              <thead class='thead'>
                <tr>
                  <th style='width: 30%'><%= t('.student_number') %></th>
                  <th style='width: 40%'><%= t('.name') %></th>
                  <th style='width: 20%'><%= t('.year_and_semester') %></th>
                  <th style='width: 10%'><%= @assessment.name %></th>
                </tr>
              </thead>
              <tbody>
                <% group.saved_enrollments.each do |enrollment| %>
                  <tr>
                    <% student = enrollment.student %>
                    <td><%= student.student_number %></td>
                    <td><%= full_name(student.user.identities.formal.first) %></td>
                    <td><%= "#{student.year}/#{student.semester}" %></td>
                    <td><%= f.input :grade, label: false, input_html: { value: enrollment.grades.find_by(course_assessment_method: @assessment)&.point, name: "course_enrollment_grades[#{enrollment.id}]" } %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
